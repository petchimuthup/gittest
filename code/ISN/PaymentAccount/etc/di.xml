<?xml version="1.0"?>
<!--
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <virtualType name="AccountPaymentFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">ISN\PaymentAccount\Model\AccountPaymentPaymentConfigProvider::METHOD_NAME</argument>
            <argument name="formBlockType" xsi:type="string">ISN\PaymentAccount\Block\Form\AccountPayment</argument>
            <argument name="infoBlockType" xsi:type="string">ISN\PaymentAccount\Block\Info\AccountPayment</argument>
            <argument name="valueHandlerPool" xsi:type="object">AccountPaymentValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">AccountPaymentValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">AccountPaymentCommandPool</argument>
        </arguments>
    </virtualType>
    <virtualType name="AccountPaymentValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">AccountPaymentDefaultValueHandler</item>
                <item name="active" xsi:type="string">ISN\PaymentAccount\Gateway\Config\ActiveHandler</item>
                <item name="payment_action" xsi:type="string">ISN\PaymentAccount\Gateway\Config\PaymentActionValueHandler</item>
                <item name="can_capture" xsi:type="string">ISN\PaymentAccount\Gateway\Config\CanCaptureValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="AccountPaymentConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">ISN\PaymentAccount\Model\AccountPaymentPaymentConfigProvider::METHOD_NAME</argument>
        </arguments>
    </virtualType>
    <virtualType name="AccountPaymentDefaultValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">AccountPaymentConfig</argument>
        </arguments>
    </virtualType>
    <type name="ISN\PaymentAccount\Gateway\Config\ActiveHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">AccountPaymentConfig</argument>
        </arguments>
    </type>
    <type name="ISN\PaymentAccount\Gateway\Command\SaleCommand">
        <arguments>
            <argument name="configInterface" xsi:type="object">AccountPaymentConfig</argument>
        </arguments>
    </type>
    <type name="ISN\PaymentAccount\Gateway\Config\PaymentActionValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">AccountPaymentConfig</argument>
        </arguments>
    </type>
    <type name="ISN\PaymentAccount\Gateway\Config\CanCaptureValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">AccountPaymentConfig</argument>
        </arguments>
    </type>
    <virtualType name="AccountPaymentCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="order" xsi:type="string">ISN\PaymentAccount\Gateway\Command\SaleCommand</item>
                <item name="capture" xsi:type="string">ISN\PaymentAccount\Gateway\Command\SaleCommand</item>
                <item name="cancel" xsi:type="string">ISN\PaymentAccount\Gateway\Command\CancelCommand</item>
                <item name="refund" xsi:type="string">ISN\PaymentAccount\Gateway\Command\RefundCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="AccountPaymentCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">AccountPaymentConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="AccountPaymentValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">AccountPaymentCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <preference for="ISN\PaymentAccount\Api\Data\CreditBalanceOptionsInterface" type="ISN\PaymentAccount\Model\CreditBalanceOptions" />
    <preference for="ISN\PaymentAccount\Api\CreditLimitRepositoryInterface" type="ISN\PaymentAccount\Model\CreditLimitRepository" />
    <preference for="ISN\PaymentAccount\Api\CreditLimitManagementInterface" type="ISN\PaymentAccount\Model\CreditLimitManagement" />
    <preference for="ISN\PaymentAccount\Api\Data\CreditLimitInterface" type="ISN\PaymentAccount\Model\CreditLimit" />
    <preference for="ISN\PaymentAccount\Api\Data\CreditDataInterface" type="ISN\PaymentAccount\Model\CreditData" />
    <preference for="ISN\PaymentAccount\Api\CreditDataProviderInterface" type="ISN\PaymentAccount\Model\CreditDataProvider" />
    <preference for="ISN\PaymentAccount\Model\HistoryRepositoryInterface" type="ISN\PaymentAccount\Model\HistoryRepository" />
    <preference for="ISN\PaymentAccount\Model\HistoryInterface" type="ISN\PaymentAccount\Model\History" />
    <preference for="ISN\PaymentAccount\Api\CreditBalanceManagementInterface" type="ISN\PaymentAccount\Model\CreditBalanceManagement" />
    <preference for="ISN\PaymentAccount\Api\CreditHistoryManagementInterface" type="ISN\PaymentAccount\Model\CreditHistoryManagement" />
    <type name="Magento\Company\Model\Company\Save">
        <plugin name="accountPaymentCreatePlugin" type="ISN\PaymentAccount\Plugin\Company\Model\AccountPaymentCreatePlugin" />
    </type>
    <type name="Magento\Quote\Api\PaymentMethodManagementInterface">
        <plugin name="paymentMethodManagementPermissionPlugin" type="ISN\PaymentAccount\Plugin\Quote\PaymentMethodManagementPlugin" />
    </type>
    <type name="Magento\Company\Model\Company\DataProvider">
        <plugin name="afterGetCompanyResultData" type="ISN\PaymentAccount\Plugin\Company\Model\DataProvider" />
    </type>
    <type name="Magento\Company\Model\Customer\Company">
        <plugin name="afterCreateCompany" type="ISN\PaymentAccount\Plugin\Company\Model\Customer\CompanyPlugin" />
    </type>
    <type name="Magento\Customer\Api\CustomerRepositoryInterface">
        <plugin name="updateCreditHistoryAfterCustomerDelete" type="ISN\PaymentAccount\Plugin\Customer\Api\CustomerRepositoryInterfacePlugin" />
    </type>
    <type name="Magento\Company\Controller\Adminhtml\Index\Edit">
        <plugin name="beforeExecute" type="ISN\PaymentAccount\Plugin\Company\Controller\Adminhtml\Index\EditPlugin" />
    </type>
    <type name="Magento\Rma\Helper\Eav">
        <plugin name="removeStoreCreditResolutionOnAdminPanel" type="ISN\PaymentAccount\Plugin\Rma\Helper\EavPlugin" />
    </type>
    <type name="Magento\Rma\Block\Form\Renderer\Select">
        <plugin name="removeStoreCreditResolutionOnStorefront" type="ISN\PaymentAccount\Plugin\Rma\Block\Form\Renderer\SelectPlugin" />
    </type>
    <type name="Magento\Sales\Model\Order\InvoiceQuantityValidator">
        <plugin name="checkPartialInvoice" type="ISN\PaymentAccount\Plugin\Sales\Model\Order\InvoiceQuantityValidatorPlugin" />
    </type>
    <type name="Magento\Sales\Model\Order">
        <plugin name="paymentPlugin" type="ISN\PaymentAccount\Plugin\Sales\Model\OrderPlugin" />
    </type>
    <type name="Magento\Sales\Model\Order\Payment\Operations\CaptureOperation">
        <plugin name="removeCaptureCommentsPlugin" type="ISN\PaymentAccount\Plugin\Sales\Model\Order\Payment\Operations\RemoveCaptureCommentsPlugin" />
    </type>
    <type name="Magento\Payment\Model\Checks\SpecificationFactory">
        <arguments>
            <argument name="mapping" xsi:type="array">
                <item name="company_permission" xsi:type="object">ISN\PaymentAccount\Model\Payment\Checks\HasCompanyPermission</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\Multishipping\Block\Checkout\Billing">
        <arguments>
            <argument name="additionalChecks" xsi:type="array">
                <item name="0" xsi:type="string">company_permission</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\Quote\Model\Quote\Payment">
        <arguments>
            <argument name="additionalChecks" xsi:type="array">
                <item name="0" xsi:type="string">company_permission</item>
            </argument>
        </arguments>
    </type>
    <type name="ISN\PaymentAccount\Model\CreditLimitHistory">
        <arguments>
            <argument name="historyRepository" xsi:type="object">\ISN\PaymentAccount\Model\HistoryRepository\Proxy</argument>
        </arguments>
    </type>
    <type name="ISN\PaymentAccount\Model\CreditCurrencyHistory">
        <arguments>
            <argument name="historyRepository" xsi:type="object">\ISN\PaymentAccount\Model\HistoryRepository\Proxy</argument>
        </arguments>
    </type>
    <type name="Magento\Config\Model\Config\TypePool">
        <arguments>
            <argument name="sensitive" xsi:type="array">
                <item name="company/email/company_credit_change" xsi:type="string">1</item>
                <item name="company/email/company_registration" xsi:type="string">1</item>
                <item name="company/email/company_registration_copy" xsi:type="string">1</item>
                <item name="company/email/company_status_change_copy" xsi:type="string">1</item>
            </argument>
        </arguments>
    </type>
</config>
